{% # theme-check-disable ValidSchema %}
<link rel="stylesheet" href="{{ 'fortune-wheel.css' | asset_url }}">

{% assign uid = block.id %}

<div
  class="vt-wheel-overlay vt-wheel-overlay--hidden vt-wheel-overlay-{{ uid }}"
  data-vt-wheel-overlay
  data-uid="{{ uid }}"
  data-email="{{ customer.email | escape }}"
  data-error-message="{{ block.settings.error_message | escape }}"
  data-success-message="{{ block.settings.success_message | escape }}"
  data-close-link="{{ block.settings.close_link | escape }}"
  data-used-message="{{ block.settings.used_message | escape }}"
  data-copy-required-message="{{ block.settings.copy_required_message | escape }}"
  data-wheel-not-configured-message="{{ block.settings.wheel_not_configured_message | escape }}"
  data-generic-error-message="{{ block.settings.generic_error_message | escape }}"
  data-success-win-template="{{ block.settings.success_win_template | escape }}"
  data-existing-win-template="{{ block.settings.existing_win_template | escape }}"
  data-copy-success-message="{{ block.settings.copy_success_message | escape }}"
  data-copy-fail-message="{{ block.settings.copy_fail_message | escape }}"
>
  <div class="vt-wheel-modal">
    <button
      type="button"
      class="vt-wheel-close"
      aria-label="Закрити"
    >
      <img 
        width="45"
        height="45"
        src="{{ 'close-icon.svg' | asset_url }}" 
        alt="Закрити">
    </button>

    <div class="vt-wheel-content">
      <div class="vt-wheel-layout">
        <div class="vt-wheel-hero">
          <div class="vt-wheel-wrapper">
          <div class="vt-wheel-pointer">
            <img
              src="{{ 'pointer.svg' | asset_url }}"
              alt="Вказівник"
              width="40"
              height="40"
            >
          </div>

            <div class="vt-wheel-disc">
              <div class="vt-wheel-labels" aria-hidden="true"></div>
              <div class="vt-wheel-center">
                <img src="{{ 'logo.png' |  asset_url }}" alt="Логотип">
              </div>
            </div>
          </div>

          <div class="vt-wheel-product">
            {% if block.settings.product_image != blank %}
              <img
                class="vt-wheel-product-image"
                src="{{ block.settings.product_image | image_url }}"
                alt="Зображення товару"
                loading="lazy"
              >
            {% endif %}
          </div>
        </div>

        <div class="vt-wheel-side">
          {%- comment -%} Блок з email (опційний) {%- endcomment -%}
          <div class="vt-wheel-email-wrapper">
            {% if block.settings.heading != blank %}
              <h2 class="vt-wheel-heading font-playfair">
                {{ block.settings.heading }}
              </h2>
            {% endif %}

            {% if block.settings.subheading != blank %}
            <p class="vt-wheel-subheading">
              {{ block.settings.subheading }}
            </p>
            {% endif %}
            <label for="vt-wheel-email-{{ uid }}" class="vt-wheel-email-label">
              {{ block.settings.email_label }}
            </label>
            <input
              id="vt-wheel-email-{{ uid }}"
              type="email"
              class="vt-wheel-email-input"
              placeholder="{{ block.settings.email_placeholder }}"
            >
            <input
              type="text"
              class="vt-wheel-hp-input"
              name="company"
              autocomplete="off"
              tabindex="-1"
              aria-hidden="true"
              style="position:absolute; left:-9999px; width:1px; height:1px; opacity:0;"
            >
          </div>

          {%- comment -%} Блок з промокодом {%- endcomment -%}
          <div class="vt-wheel-code-wrapper vt-wheel-code-wrapper--hidden">
            <div class="vt-wheel-code-header">
              <label style="color: black;" class="vt-wheel-code-label">{{ block.settings.code_label }}</label>
              <p class="vt-wheel-code-copied"></p>
            </div>
            <div class="vt-wheel-code-row">
              <input
                type="text"
                class="vt-wheel-code-input"
                readonly
              >
              <button type="button" class="vt-wheel-copy-btn">{{ block.settings.copy_button_label }}</button>
            </div>
          </div>

          <p class="vt-wheel-error" data-vt-wheel-error></p>
          <p class="vt-wheel-success" data-vt-wheel-success></p>
          {% if block.settings.button_label != blank %}
            <button type="button" class="vt-wheel-spin-btn">
              {{ block.settings.button_label }}
            </button>
          {% endif %}
          <button
            type="button"
            class="vt-wheel-spin-btn vt-wheel-use-code-btn vt-wheel-use-code-btn--hidden"
          >
            {{ block.settings.use_code_button_label }}
          </button>
          <p class="vt-wheel-checkout-note">
            {{ block.settings.checkout_note }}
          </p>
        </div>
      </div>

    </div>
  </div>
</div>

{%- comment -%}
  Маленький тригер, щоб відкрити колесо після закриття.
{%- endcomment -%}
<button
  type="button"
  class="vt-wheel-trigger vt-wheel-trigger--hidden vt-wheel-trigger-{{ uid }}"
  aria-label="Відкрити колесо"
>
  {{ block.settings.trigger_label }}
</button>

<script src="{{ 'fortune-wheel.js' | asset_url }}" defer></script>
<script src="{{ 'vt-analytics.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Wheel of Fortune",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "1) Popup: Основне"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Popup • Заголовок",
      "default": "Крути колесо фортуни!"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Popup • Підзаголовок",
      "default": "Отримай свій шанс на подарунок або знижку."
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Popup • Кнопка 'Крутити'",
      "default": "Крутити колесо"
    },
    {
      "type": "text",
      "id": "use_code_button_label",
      "label": "Popup • Кнопка 'Використати код'",
      "default": "Використати код"
    },
    {
      "type": "text",
      "id": "code_label",
      "label": "Підпис біля промокоду",
      "default": "Ваш промокод:"
    },
    {
      "type": "text",
      "id": "copy_button_label",
      "label": "Текст кнопки копіювання",
      "default": "Скопіювати"
    },
    {
      "type": "text",
      "id": "checkout_note",
      "label": "Popup • Підказка під кнопкою",
      "default": "Використайте той самий email у checkout, щоб знижка спрацювала."
    },

    {
      "type": "header",
      "content": "2) Email: Поле і валідація"
    },
    {
      "type": "text",
      "id": "email_label",
      "label": "Email • Підпис поля",
      "default": "Вкажи свій email, щоб отримати подарунок:"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email • Placeholder",
      "default": "you@example.com"
    },
    {
      "type": "text",
      "id": "error_message",
      "label": "Email • Помилка невалідного email",
      "default": "Введіть коректний email, щоб крутити колесо."
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Email • Базовий success після спіну",
      "default": "Ви успішно прокрутили колесо!"
    },
    {
      "type": "header",
      "content": "3) Системні повідомлення"
    },
    {
      "type": "text",
      "id": "used_message",
      "label": "System • Email вже використаний",
      "default": "Цей email ви вже використали. Ось ваш код:"
    },
    {
      "type": "text",
      "id": "copy_required_message",
      "label": "System • Потрібно спочатку скопіювати код",
      "default": "Скопіюй, щоб не втратити код."
    },
    {
      "type": "text",
      "id": "wheel_not_configured_message",
      "label": "System • Колесо не налаштоване",
      "default": "Колесо не налаштоване."
    },
    {
      "type": "text",
      "id": "generic_error_message",
      "label": "System • Універсальна помилка",
      "default": "Сталася помилка, спробуйте ще раз."
    },
    {
      "type": "text",
      "id": "success_win_template",
      "label": "Template • Успішний виграш ({success_message}, {label})",
      "default": "{success_message} Ваш виграш: {label}. Код дійсний 1 місяць."
    },
    {
      "type": "text",
      "id": "existing_win_template",
      "label": "Template • Існуючий виграш ({label})",
      "default": "Ваш виграш: {label}."
    },
    {
      "type": "text",
      "id": "copy_success_message",
      "label": "System • Копіювання успішне",
      "default": "Скопійовано!"
    },
    {
      "type": "text",
      "id": "copy_fail_message",
      "label": "System • Копіювання не вдалося",
      "default": "Не вдалося скопіювати :("
    },
    {
      "type": "header",
      "content": "4) Trigger, Media і дії"
    },
    {
      "type": "text",
      "id": "trigger_label",
      "label": "Trigger • Текст кнопки",
      "default": "GO"
    },
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Media • Картинка під колесом"
    },
    {
      "type": "url",
      "id": "close_link",
      "label": "Action • Посилання для кнопки закриття (необовʼязково)"
    }
  ]
}
{% endschema %}
